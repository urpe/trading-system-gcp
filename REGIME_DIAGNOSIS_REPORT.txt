INFO:BinanceDataFetcher:üì• Descargando datos de 3 s√≠mbolos (48h hacia atr√°s)...
INFO:BinanceDataFetcher:   Descargando BTC...
INFO:BinanceDataFetcher:   ‚úÖ BTC: 2880 velas descargadas
INFO:BinanceDataFetcher:   Descargando ETH...
INFO:BinanceDataFetcher:   ‚úÖ ETH: 2880 velas descargadas
INFO:BinanceDataFetcher:   Descargando SOL...
INFO:BinanceDataFetcher:   ‚úÖ SOL: 2880 velas descargadas
INFO:BinanceDataFetcher:‚úÖ Descarga completada: 3 s√≠mbolos
================================================================================
üîç DIAGN√ìSTICO DE REGIME DETECTOR - V19.1
================================================================================

üì• FASE 1: Descargando datos hist√≥ricos (√∫ltimas 48h)...
   ‚úÖ 3 s√≠mbolos descargados

üß† FASE 2: Inicializando Regime Detector...
   EMA Period: 200
   ADX Period: 14
   ADX Trend Threshold: 25

--------------------------------------------------------------------------------
üìä ANALIZANDO BTC
--------------------------------------------------------------------------------
Datos disponibles: 2880 velas
Precio inicial: $76583.00
Precio final: $76380.97
Cambio: -0.26%

TEST 1: Detecci√≥n SIN high/low (modo actual del sistema)
2026-02-04 07:37:02,494 | INFO     | RegimeDetector  | ‚ÜîÔ∏è SIDEWAYS market: ADX=0.1 < 20
INFO:RegimeDetector:‚ÜîÔ∏è SIDEWAYS market: ADX=0.1 < 20
   R√©gimen detectado: sideways_range
   ADX: 0.07
   EMA200: $76516.26
   Precio vs EMA: N/A

TEST 2: Detecci√≥n CON high/low (modo correcto)
2026-02-04 07:37:02,495 | INFO     | RegimeDetector  | ‚ÜîÔ∏è SIDEWAYS market: ADX=9.5 < 20
INFO:RegimeDetector:‚ÜîÔ∏è SIDEWAYS market: ADX=9.5 < 20
   R√©gimen detectado: sideways_range
   ADX: 9.48
   DI+: 23.74
   DI-: 19.63
   EMA200: $76516.26
   Precio vs EMA: N/A
   ATR: 0.06%

TEST 3: An√°lisis Manual
   Precio actual: $76380.97
   EMA(200): $76491.83
   Tendencia: BAJISTA
   Cambio 7d: -0.35%

üéØ VEREDICTO:
   ‚úÖ ADX funciona en modo fallback: 0.07
   ‚úÖ Ambos modos detectan mismo r√©gimen: sideways_range
   ‚ö†Ô∏è  DIFERENCIA ADX SIGNIFICATIVA: +9.41 puntos

--------------------------------------------------------------------------------
üìä ANALIZANDO ETH
--------------------------------------------------------------------------------
Datos disponibles: 2880 velas
Precio inicial: $2233.08
Precio final: $2280.29
Cambio: +2.11%

TEST 1: Detecci√≥n SIN high/low (modo actual del sistema)
2026-02-04 07:37:02,497 | INFO     | RegimeDetector  | ‚ÜîÔ∏è SIDEWAYS market: ADX=0.0 < 20
INFO:RegimeDetector:‚ÜîÔ∏è SIDEWAYS market: ADX=0.0 < 20
   R√©gimen detectado: sideways_range
   ADX: 0.05
   EMA200: $2275.16
   Precio vs EMA: N/A

TEST 2: Detecci√≥n CON high/low (modo correcto)
2026-02-04 07:37:02,498 | INFO     | RegimeDetector  | üìà BULL TREND: Price=2280.29 > EMA200=2275.16, ADX=38.1
INFO:RegimeDetector:üìà BULL TREND: Price=2280.29 > EMA200=2275.16, ADX=38.1
   R√©gimen detectado: bull_trend
   ADX: 38.09
   DI+: 30.87
   DI-: 13.84
   EMA200: $2275.16
   Precio vs EMA: N/A
   ATR: 0.12%

TEST 3: An√°lisis Manual
   Precio actual: $2280.29
   EMA(200): $2273.54
   Tendencia: ALCISTA
   Cambio 7d: +1.92%

üéØ VEREDICTO:
   ‚úÖ ADX funciona en modo fallback: 0.05
   ‚ö†Ô∏è  DISCREPANCIA: sideways_range vs bull_trend
   üîß SOLUCI√ìN: Market Data debe enviar high/low en Redis
   ‚ö†Ô∏è  DIFERENCIA ADX SIGNIFICATIVA: +38.04 puntos

--------------------------------------------------------------------------------
üìä ANALIZANDO SOL
--------------------------------------------------------------------------------
Datos disponibles: 2880 velas
Precio inicial: $101.82
Precio final: $97.97
Cambio: -3.78%

TEST 1: Detecci√≥n SIN high/low (modo actual del sistema)
2026-02-04 07:37:02,500 | INFO     | RegimeDetector  | ‚ÜîÔ∏è SIDEWAYS market: ADX=0.2 < 20
INFO:RegimeDetector:‚ÜîÔ∏è SIDEWAYS market: ADX=0.2 < 20
   R√©gimen detectado: sideways_range
   ADX: 0.21
   EMA200: $98.05
   Precio vs EMA: N/A

TEST 2: Detecci√≥n CON high/low (modo correcto)
2026-02-04 07:37:02,501 | INFO     | RegimeDetector  | üìâ BEAR TREND: Price=97.97 < EMA200=98.05, ADX=27.7
INFO:RegimeDetector:üìâ BEAR TREND: Price=97.97 < EMA200=98.05, ADX=27.7
   R√©gimen detectado: bear_trend
   ADX: 27.72
   DI+: 26.79
   DI-: 15.16
   EMA200: $98.05
   Precio vs EMA: N/A
   ATR: 0.13%

TEST 3: An√°lisis Manual
   Precio actual: $97.97
   EMA(200): $98.00
   Tendencia: BAJISTA
   Cambio 7d: -3.74%

üéØ VEREDICTO:
   ‚úÖ ADX funciona en modo fallback: 0.21
   ‚ö†Ô∏è  DISCREPANCIA: sideways_range vs bear_trend
   üîß SOLUCI√ìN: Market Data debe enviar high/low en Redis
   ‚ö†Ô∏è  DIFERENCIA ADX SIGNIFICATIVA: +27.51 puntos

================================================================================
üìã CONCLUSIONES Y RECOMENDACIONES
================================================================================

PROBLEMA RA√çZ:
- El servicio market_data solo publica 'close' price en Redis
- Brain no recibe high/low para c√°lculo correcto de ADX
- Fallback usa estimaci√≥n que retorna ADX muy bajo o 0

IMPACTO:
- Sistema detecta UNKNOWN o SIDEWAYS incorrectamente
- Mean Reversion se activa en tendencias fuertes (FATAL)
- V19 oper√≥ en mercado bajista -8% como si fuera lateral

SOLUCI√ìN V21:
1. Modificar market_data para publicar OHLC completo en Redis
   - Cambiar: redis.set(f'price:{symbol}', price)
   - A: redis.hset(f'ohlc:{symbol}', mapping={'open': o, 'high': h, 'low': l, 'close': c})

2. Modificar Brain para leer high/low de Redis
   - Mantener cach√© de high/low por s√≠mbolo
   - Pasar high_history y low_history al detector

3. Re-test detector con datos completos
   - Ejecutar este script de nuevo
   - Verificar ADX > 0 en tendencias

================================================================================
