name: Continuous Deployment v5.0
on:
  push:
    branches: [ main ]
env:
  PROJECT_ID: mi-proyecto-trading-12345
  REGION: us-central1
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    - name: Google Auth
      uses: 'google-github-actions/auth@v2'
      with:
        credentials_json: '${{ secrets.GCP_SA_KEY }}'
    - name: 'Set up Cloud SDK'
      uses: 'google-github-actions/setup-gcloud@v2'
    - name: 'Deploy Infrastructure'
      run: |
        # 1. Dashboard (La Torre de Control)
        gcloud run deploy dashboard --source ./dashboard --region ${{ env.REGION }} --quiet --allow-unauthenticated
        
        # 2. Market Data Hub (Consolidado - Reemplaza a los 5 ingestores)
        gcloud run deploy market-data-hub --source ./services/market_data_hub --region ${{ env.REGION }} --quiet --allow-unauthenticated
        
        # 3. Motores de Trading
        gcloud run deploy pairs-trading-engine --source ./services/pairs_trading --region ${{ env.REGION }} --quiet --allow-unauthenticated
        gcloud run deploy backtesting-simulator --source ./services/backtesting --region ${{ env.REGION }} --quiet --allow-unauthenticated
        
        # 4. Agentes de Ejecuci√≥n
        gcloud run deploy order-agent --source ./order_agent --region ${{ env.REGION }} --quiet --allow-unauthenticated
        gcloud run deploy alert-service --source ./alert_service --region ${{ env.REGION }} --quiet --allow-unauthenticated
