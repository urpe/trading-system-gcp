<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Bot Dashboard v2.0</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0d1117; color: #c9d1d9; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 1px solid #30363d; padding-bottom: 20px; }
        h1 { font-size: 2.5em; color: #58a6ff; }
        .status { background: #238636; padding: 8px 16px; border-radius: 6px; font-weight: bold; }
        
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid #30363d; }
        .tab-btn { padding: 12px 20px; background: #161b22; border: none; color: #8b949e; cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.3s; }
        .tab-btn.active { color: #58a6ff; border-bottom-color: #58a6ff; }
        .tab-btn:hover { color: #79c0ff; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr )); gap: 15px; margin-bottom: 30px; }
        .metric-card { background: #161b22; border: 1px solid #30363d; padding: 20px; border-radius: 8px; text-align: center; }
        .metric-value { font-size: 2em; font-weight: bold; color: #58a6ff; margin: 10px 0; }
        .metric-label { color: #8b949e; font-size: 0.9em; }
        
        .chart-container { background: #161b22; border: 1px solid #30363d; padding: 20px; border-radius: 8px; margin-bottom: 30px; position: relative; height: 400px; }
        
        table { width: 100%; border-collapse: collapse; background: #161b22; border: 1px solid #30363d; border-radius: 8px; overflow: hidden; }
        th { background: #0d1117; padding: 12px; text-align: left; color: #8b949e; font-weight: 600; border-bottom: 1px solid #30363d; }
        td { padding: 12px; border-bottom: 1px solid #30363d; }
        tr:hover { background: #0d1117; }
        
        .badge { padding: 4px 12px; border-radius: 20px; font-size: 0.85em; font-weight: 600; }
        .badge-buy { background: #238636; color: white; }
        .badge-sell { background: #da3633; color: white; }
        .badge-success { background: #238636; color: white; }
        .badge-failed { background: #da3633; color: white; }
        
        footer { text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #30363d; color: #8b949e; font-size: 0.9em; }
        
        .empty-state { text-align: center; padding: 40px; color: #8b949e; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>游뱄 Trading Bot Dashboard v2.0</h1>
            <div class="status">Sistema Activo</div>
        </header>
        
        <!-- RESUMEN GLOBAL -->
        <div id="global-tab" class="tab-content active">
            <h2 style="margin-bottom: 20px;">游늵 Resumen Global</h2>
            <div class="metrics">
                <div class="metric-card">
                    <div class="metric-label">Total Se침ales</div>
                    <div class="metric-value">{{ global_metrics.total_signals }}</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Compras (BUY)</div>
                    <div class="metric-value" style="color: #3fb950;">{{ global_metrics.buy_count }}</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Ventas (SELL)</div>
                    <div class="metric-value" style="color: #f85149;">{{ global_metrics.sell_count }}</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Win Rate</div>
                    <div class="metric-value">{{ global_metrics.win_rate }}%</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">칍rdenes Exitosas</div>
                    <div class="metric-value">{{ global_metrics.successful_orders }}/{{ global_metrics.total_orders }}</div>
                </div>
            </div>
            
            <h3 style="margin-bottom: 15px;">游늳 Resumen por Moneda</h3>
            <table>
                <thead>
                    <tr>
                        <th>Moneda</th>
                        <th>Se침ales</th>
                        <th>Compras</th>
                        <th>Ventas</th>
                        <th>칍rdenes</th>
                        <th>Exitosas</th>
                    </tr>
                </thead>
                <tbody>
                    {% for symbol, metrics in global_metrics.by_symbol.items() %}
                    <tr>
                        <td><strong>{{ symbol }}</strong></td>
                        <td>{{ metrics.total_signals }}</td>
                        <td><span class="badge badge-buy">{{ metrics.buy_count }}</span></td>
                        <td><span class="badge badge-sell">{{ metrics.sell_count }}</span></td>
                        <td>{{ metrics.total_orders }}</td>
                        <td><span class="badge badge-success">{{ metrics.successful_orders }}</span></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- PESTA칌AS POR MONEDA -->
        <div class="tabs" id="symbol-tabs">
            <button class="tab-btn active" onclick="switchTab('global-tab', this)">游늵 Resumen Global</button>
            {% for symbol in symbols %}
            <button class="tab-btn" onclick="switchTab('tab-{{ symbol }}', this)">{{ symbol }}</button>
            {% endfor %}
        </div>
        
        {% for symbol in symbols %}
        <div id="tab-{{ symbol }}" class="tab-content">
            <h2 style="margin-bottom: 20px;">{{ symbol }} - An치lisis Detallado</h2>
            <div class="metrics">
                <div class="metric-card">
                    <div class="metric-label">Se침ales</div>
                    <div class="metric-value" id="metric-signals-{{ symbol }}">0</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Compras</div>
                    <div class="metric-value" style="color: #3fb950;" id="metric-buy-{{ symbol }}">0</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Ventas</div>
                    <div class="metric-value" style="color: #f85149;" id="metric-sell-{{ symbol }}">0</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">칍rdenes</div>
                    <div class="metric-value" id="metric-orders-{{ symbol }}">0</div>
                </div>
            </div>
            
            <h3 style="margin-bottom: 15px;">칔ltimas Se침ales</h3>
            <table id="signals-table-{{ symbol }}">
                <thead>
                    <tr>
                        <th>Acci칩n</th>
                        <th>Precio</th>
                        <th>Raz칩n</th>
                        <th>Timestamp</th>
                    </tr>
                </thead>
                <tbody id="signals-body-{{ symbol }}">
                    <tr><td colspan="4" class="empty-state">Sin datos</td></tr>
                </tbody>
            </table>
            
            <h3 style="margin-bottom: 15px; margin-top: 30px;">Historial de 칍rdenes</h3>
            <table id="orders-table-{{ symbol }}">
                <thead>
                    <tr>
                        <th>Acci칩n</th>
                        <th>Cantidad</th>
                        <th>Estado</th>
                        <th>Timestamp</th>
                    </tr>
                </thead>
                <tbody id="orders-body-{{ symbol }}">
                    <tr><td colspan="4" class="empty-state">Sin datos</td></tr>
                </tbody>
            </table>
        </div>
        {% endfor %}
        
        <footer>Trading Bot Dashboard v2.0 | Powered by Google Cloud Platform</footer>
    </div>
    
    <script>
        function switchTab(tabId, btn) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            btn.classList.add('active');
        }
        
        async function loadSymbolData(symbol) {
            try {
                const response = await fetch(`/api/symbol/${symbol}`);
                const data = await response.json();
                
                const signals = data.signals || [];
                const orders = data.orders || [];
                
                document.getElementById(`metric-signals-${symbol}`).textContent = signals.length;
                document.getElementById(`metric-buy-${symbol}`).textContent = signals.filter(s => s.action === 'BUY').length;
                document.getElementById(`metric-sell-${symbol}`).textContent = signals.filter(s => s.action === 'SELL').length;
                document.getElementById(`metric-orders-${symbol}`).textContent = orders.length;
                
                const signalsBody = document.getElementById(`signals-body-${symbol}`);
                signalsBody.innerHTML = signals.length > 0 ? signals.map(s => `
                    <tr>
                        <td><span class="badge badge-${s.action.toLowerCase()}">${s.action}</span></td>
                        <td>$${s.price.toFixed(2)}</td>
                        <td>${s.reason}</td>
                        <td>${new Date(s.timestamp).toLocaleString()}</td>
                    </tr>
                `).join('') : '<tr><td colspan="4" class="empty-state">Sin datos</td></tr>';
                
                const ordersBody = document.getElementById(`orders-body-${symbol}`);
                ordersBody.innerHTML = orders.length > 0 ? orders.map(o => `
                    <tr>
                        <td><span class="badge badge-${o.signal_received.action.toLowerCase()}">${o.signal_received.action}</span></td>
                        <td>${o.signal_received.quantity}</td>
                        <td><span class="badge badge-${o.order_status.toLowerCase()}">${o.order_status}</span></td>
                        <td>${new Date(o.timestamp).toLocaleString()}</td>
                    </tr>
                `).join('') : '<tr><td colspan="4" class="empty-state">Sin datos</td></tr>';
            } catch (e) {
                console.error(`Error cargando datos para ${symbol}:`, e);
            }
        }
        
        // Cargar datos de todas las monedas al iniciar
        const symbols = {{ symbols | tojson }};
        symbols.forEach(symbol => loadSymbolData(symbol));
        
        // Actualizar cada 30 segundos
        setInterval(() => {
            symbols.forEach(symbol => loadSymbolData(symbol));
        }, 30000);
    </script>
</body>
</html>
