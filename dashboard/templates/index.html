{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
    <h1>üìä Dashboard de Trading</h1>
    <p class="text-muted">Sistema de trading automatizado con datos en tiempo real</p>
    
    <!-- Resumen del Mercado -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <h6>Activos Monitoreados</h6>
                    <h2>{{ summary.total_assets }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <h6>Activos con Datos</h6>
                    <h2>{{ summary.active_assets }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card {% if summary.avg_change > 0 %}bg-success{% elif summary.avg_change < 0 %}bg-danger{% else %}bg-secondary{% endif %} text-white">
                <div class="card-body">
                    <h6>Cambio Promedio 24h</h6>
                    <h2>{{ summary.avg_change }}%</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-dark text-white">
                <div class="card-body">
                    <h6>Estado del Mercado</h6>
                    <h2>{{ summary.market_status }}</h2>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Tabla de Precios -->
    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h4 class="mb-0">üí∞ Precios en Tiempo Real</h4>
            <small class="text-muted">Datos desde Binance v√≠a Europa</small>
        </div>
        <div class="card-body">
            <table class="table table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Activo</th>
                        <th>Precio (USD)</th>
                        <th>Cambio 24h</th>
                        <th>M√°ximo</th>
                        <th>M√≠nimo</th>
                        <th>Volumen</th>
                        <th>Acci√≥n</th>
                    </tr>
                </thead>
                <tbody>
                    {% for asset in assets %}
                    <tr {% if data[asset].price|default(0) == 0 %}class="table-warning"{% endif %}>
                        <td><strong>{{ asset }}/USDT</strong></td>
                        <td>
                            {% if data[asset].price|default(0) > 0 %}
                                ${{ "%.2f"|format(data[asset].price) }}
                            {% else %}
                                <span class="text-muted">Sin datos</span>
                            {% endif %}
                        </td>
                        <td class="{% if data[asset].change|default(0) > 0 %}text-success{% elif data[asset].change|default(0) < 0 %}text-danger{% else %}text-muted{% endif %}">
                            {% if data[asset].price|default(0) > 0 %}
                                {{ "%.2f"|format(data[asset].change|default(0)) }}%
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            {% if data[asset].high|default(0) > 0 %}
                                ${{ "%.2f"|format(data[asset].high) }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            {% if data[asset].low|default(0) > 0 %}
                                ${{ "%.2f"|format(data[asset].low) }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            {% if data[asset].volume|default(0) > 0 %}
                                {{ "%.0f"|format(data[asset].volume) }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            <a href="/asset/{{ asset }}" class="btn btn-sm btn-outline-primary">Ver Detalles</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- √öltimas Se√±ales -->
    <div class="card">
        <div class="card-header">
            <h4 class="mb-0">üö¶ √öltimas Se√±ales de Trading</h4>
        </div>
        <div class="card-body">
            {% if signals %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Activo</th>
                        <th>Se√±al</th>
                        <th>Precio</th>
                        <th>Raz√≥n</th>
                    </tr>
                </thead>
                <tbody>
                    {% for signal in signals %}
                    <tr>
                        <td><strong>{{ signal.symbol }}</strong></td>
                        <td>
                            <span class="badge {% if signal.signal == 'BUY' %}bg-success{% elif signal.signal == 'SELL' %}bg-danger{% else %}bg-secondary{% endif %}">
                                {{ signal.signal|default('N/A') }}
                            </span>
                        </td>
                        <td>${{ "%.2f"|format(signal.price|default(0)) }}</td>
                        <td><small>{{ signal.reason|default('Sin raz√≥n') }}</small></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="alert alert-info mb-0">
                <strong>‚ÑπÔ∏è Info:</strong> No hay se√±ales recientes. El Strategy Agent generar√° se√±ales cuando reciba datos del Market Data Hub.
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Navegaci√≥n R√°pida -->
    <div class="row mt-4">
        <div class="col-md-6">
            <a href="/simulator" class="card text-decoration-none">
                <div class="card-body text-center">
                    <h3>üöÄ</h3>
                    <h5>Simulador de Estrategias</h5>
                    <p class="text-muted mb-0">Prueba estrategias con datos hist√≥ricos</p>
                </div>
            </a>
        </div>
        <div class="col-md-6">
            <a href="/pairs" class="card text-decoration-none">
                <div class="card-body text-center">
                    <h3>‚öñÔ∏è</h3>
                    <h5>Pairs Trading</h5>
                    <p class="text-muted mb-0">Analiza correlaciones entre activos</p>
                </div>
            </a>
        </div>
    </div>
</div>
{% endblock %}
